<!doctype html><html lang=pl><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>Deploying SUSE CaaS Platform on AWS | EngineerBetter | More than Cloud Platform specialists</title><link rel=stylesheet href="/css/main.css?v=4"><link rel=stylesheet href=/css/syntax.css><link rel=icon type=image/png href=/img/favicon.png><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-74442484-1","auto"),ga("send","pageview")</script><script src=//load.sumome.com/ data-sumo-site-id=7c63408cd1c29faa63d20123ff629d524df6674695e4305a0e602f2bbf431038 async></script>
<script type=text/javascript>var _iub=_iub||[];_iub.csConfiguration={banner:{textColor:"#dadada",backgroundColor:"#5A5A5A"},lang:"en",siteId:939573,cookiePolicyId:8251825}</script><script type=text/javascript src=//cdn.iubenda.com/cookie_solution/safemode/iubenda_cs.js async></script></head><body><section id=menu-nav-top class="menu fixed-menu clearfix"><div class=menu_contact><p class=menu_contact-number>+44 (0) 20 7846 0140</p><a href=mailto:contact@engineerbetter.com class=menu_contact-us>Contact us</a></div><div class="menu_header clearfix"><button class=menu_header-button>
<span class="icon-bar top-bar"></span>
<span class="icon-bar middle-bar"></span>
<span class="icon-bar bottom-bar"></span></button>
<a href=/ class=menu_header-logo><img class=logo-header-img alt=Brand src=/img/engineer-better-logo.svg></a></div></section><div class=menu_list><button class=menu_list-close><p>&#x2716;</p></button><div class=menu_list-inner-wrap><p class=menu_list-phone>+44 (0) 20 7846 0140</p><a class=menu_list-contact-btn href=mailto:contact@engineerbetter.com>Contact us&nbsp;<span>&#xe900;</span></a><ul class=menu_list-links><li><a href=/how-we-work/>How we work</a></li><li><a href=/our-services/>Our services</a></li><li><a href=/success-stories/>Success stories</a></li><li><a href=/why-cloud-native/>why cloud-native?</a></li><li><a href=/about-us/>About us</a></li><li><a href=/blog/>Blog</a></li></ul><div class=menu_list-icons><a href=https://twitter.com/EngineerBetter><img src=/img/twitter.svg alt="Twitter profile"></a>
<a href=https://github.com/EngineerBetter><img src=/img/github.svg alt="Github profile"></a></div><div class=menu_list-bot-menu><a href=/blog/>Blog</a><span>|</span><a href=/join-our-team/>Careers</a><span>|</span><a href=//www.iubenda.com/privacy-policy/8251825 class="iubenda-nostyle no-brand iubenda-embed" title="Privacy Policy">Privacy</a><script type=text/javascript>(function(e,t){var n=function(){var e=t.createElement("script"),n=t.getElementsByTagName("script")[0];e.src="//cdn.iubenda.com/iubenda.js",n.parentNode.insertBefore(e,n)};e.addEventListener?e.addEventListener("load",n,!1):e.attachEvent?e.attachEvent("onload",n):e.onload=n})(window,document)</script></div></div></div><section class="menu-banner-top_wrap parallax is-page"><div class=menu-banner-top><div class=menu-banner-top_contact><a class=menu-banner-top_number href="tel:+44 (0) 20 7846 0140">+44 (0) 20 7846 0140</a>
<a class=menu-banner-top_contact-us href=mailto:contact@engineerbetter.com>Contact us</a></div><div class=menu-banner-top_btn-wrap><button class=menu_header-button>
<span class="icon-bar top-bar"></span>
<span class="icon-bar middle-bar"></span>
<span class="icon-bar bottom-bar"></span></button></div><div class="menu-banner-top_logo clearfix"><a href=/ class=home-banner_logo-img><img class=logo-img alt=Brand src=/img/engineer-better-logo.svg></a></div></div><div class=home-banner><div class="home-banner_list clearfix"><div class=home-banner_list-category><ul><li><a href=ileri.com/how-we-work/>How we work</a></li><li><a href=ileri.com/our-services/>Our services</a></li><li><a href=ileri.com/success-stories/>Success Stories</a></li><li><a href=ileri.com/why-cloud-native/>Why Cloud-Native?</a></li><li><a href=ileri.com/about-us/>About us</a></li><li><a href=ileri.com/blog/>Blog</a></li></ul></div><div class=home-banner_textarea><h1 class=home-banner_textarea-header>Our <strong>blog&nbsp;<span>&#xe900;</span></strong></h1><div class=home-banner_textarea-wrap><p class=home-banner_textarea-description>Get the very latest updates about recent projects, team updates, thoughts and industry news from our team of EngineerBetter experts.</p></div></div></div></div></section><section class=blog-page><div class=blog-page_container><h1>Deploying SUSE CaaS Platform on AWS</h1><p class=blog-page_details>Jun 30, 2020<span>|</span> Jessica Stenning</p><div class=blog-page_image><img src=/img/blog/shipping-containers.jpg></div><p>The SUSE Containers as a Service (CaaS) Platform deployment on AWS recently went into technological preview (as of <a href=https://www.suse.com/releasenotes/x86_64/SUSE-CAASP/4/#_deployment_on_aws_as_technology_preview>version 4.1.2</a>). I spent a few days going through the docs and deploying my own SUSE CaaS Platform (v4.2.1) on AWS, and here are my tips for a smooth deployment.</p><blockquote><p>This blog post makes reference to &ldquo;Master&rdquo; nodes. This terminology is used only to maintain consistency with the official documentation.</p></blockquote><h2 id=what-is-susecaas-platform>What is SUSE CaaS Platform?</h2><p>First off, what is SUSE CaaS Platform? As SUSE have put it: &lsquo;SUSE CaaS Platform is an enterprise class container management solution that enables IT and DevOps professionals to more easily deploy, manage, and scale container-based applications and services&rsquo;.</p><p>Or, if that&rsquo;s too much of a mouthful for you, think Kubernetes with bells and whistles on.</p><p>It uses:</p><ul><li>SUSE&rsquo;s Cloud Native Computing Foundation (CNCF) certified Kubernetes distribution;</li><li>SUSE Linux Enterprise Server(SLES) 15 SP1 container OS;</li><li>SUSE managed container image registry;</li><li>Cilium for networking;</li><li>Helm for package management;</li><li>Custom tooling designed to simplify deployment, scaling, and maintenance of Kubernetes.</li></ul><p>Here&rsquo;s the <a href=https://documentation.suse.com/suse-caasp/4.2/html/caasp-deployment/_deployment_scenarios.html#_default_deployment_scenario>reference architecture</a> for CaaS Platform 4.2.X:</p><p></p><h2 id=why-would-you-want-to-use-it>Why would you want to use it?</h2><p>To put it plainly, you&rsquo;re an enterprise organisation that wants to utilise the benefits of Kubernetes (reduced infrastructure costs, faster application delivery cycle times, all-round improvements to productivity and so on), BUT you&rsquo;re an <em>enterprise</em> so you need a solution that will get sign-off from the security team - a fully supported solution based on a robust container OS helps ticks those boxes.</p><p>Additionally, because SUSE&rsquo;s certified distribution of upstream Kubernetes utilises only Kubernetes&rsquo; features and APIs (no unnecessary additional layers or special APIs), there&rsquo;s no vendor lock-in. If you think one day you might want to move Kubernetes to another cloud provider, or utilise Kubernetes across multiple public and private clouds (or non-cloud resources), SUSE CaaS Platform provides an out of the box portable solution.</p><h2 id=im-sold-how-do-i-deploy-it-on-aws>I&rsquo;m sold, how do I deploy it on AWS?</h2><p><em>This blog post is based on the deployment of SUSE CaaS Platform on AWS, rather than any ongoing maintenance or administration</em></p><p>The process to deploy on AWS is documented, but as previously mentioned, it&rsquo;s currently in tech preview, and there are a couple of caveats to getting it up and running quickly and successfully. The following steps have been written to be read <em>alongside</em> <a href=https://documentation.suse.com/suse-caasp/4.2/html/caasp-deployment/_deployment_instructions.html#>the official SUSE documentation</a>, not instead of.</p><h2 id=1-register-for-a-free-trial-of-suse-caas-platform>1. Register for a free trial of SUSE CaaS Platform</h2><p>This is easily done via the <a href="https://www.suse.com/products/caas-platform/trials/MkpwEt3Ub98~/?campaign_name=Eval:_CaaSP_4">SUSE Website</a>, once you&rsquo;ve gone through the registration process you&rsquo;ll be given a trial registration code - keep a note of this as you&rsquo;ll be using it at various stages of the deployment process. A trial of SUSE CaaS Platform lasts 2 months.</p><p></p><h2 id=2-deploy-a-management-workstation>2. Deploy a &lsquo;Management&rsquo; workstation</h2><p>Firstly you&rsquo;ll need an instance to bootstrap the entire deployment process. The initial deployment step for CaaS Platform on AWS utilises some SUSE-defined Terraform templates to spin up the infrastructure for your cluster. Before you can do that you&rsquo;ll need somewhere to run that Terraform <em>from</em>, and as the docs state, you&rsquo;ll need to be running SUSE Linux Enterprise Server (SLES) 15 SP1 to install those packages.</p><p>As someone with no experience deploying or operating SLES, it took me a little while to work out the best way to spin up one of these instances to act as my Management instance.</p><p>When you register for your free trial of SUSE CaaS Platform you&rsquo;re given access to some downloadable material, some <code>iso</code> images for the SLES server with or without packages bundled in (visible in the screenshot above). I started out creating an instance from the SLES <code>iso</code> image on Virtualbox to get up and running quickly. While this <em>technically</em> worked, it was a bit painful to get things done, and I wanted to look at automated deployments down the line so pivoted to using AWS instead.</p><h3 id=21-aws-management-workstation>2.1 AWS &lsquo;Management&rsquo; workstation</h3><p>While AWS offers a standard SLES 15 SP1 in its marketplace, it is (currently) not possible to add the CaaS Platform repos to this instance. This took me a while to work out, and as far as I can see, isn&rsquo;t currently documented.</p><p>So, while the first paragraph of the deployment docs states that you need a workstation running SLES 15 SP1 or equivalent, the &lsquo;standard&rsquo; AWS AMI is not sufficient.</p><p>Instead, using my previous Virtualbox deployment, I identified the AMI used in the terraform to deploy the Master and Worker nodes and used this AMI to create my Management workstation (currently <code>ami-020aaee0bf8836bf0</code>) - the docs state that you can run cluster bootstrap commands from the master node, so I took an educated guess that this AMI would have everything needed, and it did!</p><p>Again, this isn&rsquo;t documented as a supported method of implementation, but it was effective in my case.</p><h2 id=3-management-ssh-key>3. Management SSH key</h2><p>When creating the SSH key on your Management instance in the <a href=https://documentation.suse.com/suse-caasp/4.2/html/caasp-deployment/_deployment_instructions.html#ssh.configuration>first step</a> of the deployment instructions, make sure to run <code>ssh-keygen -t rsa</code>, rather than copy pasting the <code>ssh-keygen -t ed25519</code> as suggested. You&rsquo;ll hit issues with AWS key incompatibiliy during the Terraform stages later on if you don&rsquo;t.</p><h2 id=4-install-the-installation-tools>4. Install the installation tools</h2><p>Go through the <a href=https://documentation.suse.com/suse-caasp/4.2/html/caasp-deployment/_deployment_instructions.html#_installation_tools>tool installation steps</a> to get Terraform and <code>skuba</code> installed on the Management instance along with the necessary configuration files (you&rsquo;ll need your trial registration code to complete these steps).</p><blockquote><p>Note: <code>skuba</code> is the SUSE-built cli that wraps around <code>kubeadm</code> to simplify deployments and upgrades of kubadm-based clusters.</p></blockquote><p>Once you&rsquo;ve completed these steps you can navigate to the <a href=https://documentation.suse.com/suse-caasp/4.2/html/caasp-deployment/_deployment_instructions.html#_deployment_on_amazon_web_services_aws>AWS specific deployment instructions</a></p><h2 id=5-terraform>5. Terraform</h2><p>As instructed, fill out the values required in the <code>terraform.tfvars</code> file, and then run a <code>terraform apply</code> to spin up your infrastructure (you&rsquo;ll need your trial registration code for this step too).</p><p>You might need to install vim to make filling this file out easier, if that&rsquo;s the case do it with zypper</p><pre tabindex=0><code>sudo zypper in vim
</code></pre><h2 id=6-do-all-cluster-bootstrapping-from-the-master-node>6. Do all cluster bootstrapping from the Master node</h2><p>Seeing as the Worker nodes aren&rsquo;t assigned a public IP, and the Management instance is deployed to a different VPC than the Master and Worker nodes, I found that the easiest way to boostrap the cluster is from the Master node.</p><p>This means that your Master node will need to have ssh access to the nodes you intend to add to the cluster, it&rsquo;ll also need <code>skuba</code> installed to perform the bootstrapping.</p><h3 id=61-install-skuba-on-the-master-node>6.1 Install skuba on the Master node</h3><p>You&rsquo;ll need the <code>skuba</code> cli installed on the Master node to complete the bootstrap process. Run the commands included in the <a href=https://documentation.suse.com/suse-caasp/4.2/html/caasp-deployment/bootstrap.html#_install_skuba>&lsquo;Preparation&rsquo;</a> section to set this up. Here the <code>&lt;PRODUCT-KEY></code> is your SUSE CaaS Platform registration code. You will need to run these commands with root priveleges.</p><h3 id=62-use-ssh-agent-forwarding-to-grant-the-master-node-ssh-access>6.2 Use ssh-agent forwarding to grant the master node ssh access</h3><p>Rather than copying over the private key from the Management instance, use <code>ssh-agent</code> forwarding to allow the Master node to use the local ssh-agent on the Management instance.</p><p>From the Management node run:</p><pre tabindex=0><code>ssh -A ec2-user@myip
</code></pre><p>This will give you ssh access to the other nodes in the cluster, which is required for bootstrapping the cluster with <code>skuba</code>.</p><h2 id=7-complete-the-cluster-bootstrap-with-skuba>7. Complete the cluster bootstrap with skuba</h2><p>Now it&rsquo;s just a case of <a href=https://documentation.suse.com/suse-caasp/4.2/html/caasp-deployment/bootstrap.html#_amazon_web_services_aws_cpi>initialising your cluster</a>, you can get your Load Balancer IP/FQDN from the terraform output on your Management instance, or directly from the AWS console.</p><p>Once your cluster&rsquo;s initialised you can <a href=https://documentation.suse.com/suse-caasp/4.2/html/caasp-deployment/bootstrap.html#cluster.bootstrap>boostrap the nodes</a>.</p><p>A couple of points to note:</p><ul><li>When running <code>skuba</code> on AWS the user will be <code>ec2-user</code>, not <code>sles</code>.</li><li>When using the AWS cloud provider integration, the cloud provider has authority on node names and addresses, so you must boostrap and join nodes using their private dns.</li></ul><p>So, your first <code>skuba</code> bootstrap command will look look like this:</p><pre tabindex=0><code>skuba node bootstrap --user ec2-user --sudo --target &lt;NODE_IP/FQDN&gt; &lt;NODE_PRIVATE_DNS&gt;
</code></pre><p>Once you&rsquo;ve joined all of your Master and Worker nodes to the cluster you&rsquo;re done! You should be able to see a happy cluster with <code>skuba cluster status</code>, and install and interact with <code>kubectl</code> commands to start deploying pods your cluster!</p><p>For guidance on ongoing maintenance and administrative tasks associated with your SUSE CaaS Platform see the official <a href=https://documentation.suse.com/suse-caasp/4.2/html/caasp-admin/index.html>Administration Guide</a></p></div><div class="blog-page_banner clearfix"><div class=blog_banner-text><h2>Get in touch</h2><p>See how much we can help you.<br>Call <span>+44 (0) 20 7846 0140</span> or</br></p><a href=mailto:contact@engineerbetter.com class=cloud-btn2><p>Contact us <span>&#xe900;</span></p></a></div></div></section><footer><div class=footer-background></div><div class="footer_wrap clearfix"><div class=footer_column-list-desktop><ul class=list><li><a href=/how-we-work/><span>&mdash;</span> How we work</a></li><li><a href=/our-services/><span>&mdash;</span> Our services</a></li><li><a href=/success-stories/><span>&mdash;</span> Success stories</a></li><li><a href=/why-cloud-native/><span>&mdash;</span> Why Cloud-Native?</a></li><li><a href=/about-us/><span>&mdash;</span> About us</a></li></ul></div><div class=footer_column-list><ul class=list><li><a href=mailto:contact@engineerbetter.com><span>&mdash;</span> Contact us</a></li><li><a href=/blog/><span>&mdash;</span> Blog</a></li><li><a href=/join-our-team/><span>&mdash;</span> Join our team</a></li><li><a href=//www.iubenda.com/privacy-policy/8251825 class="iubenda-nostyle no-brand iubenda-embed" title="Privacy Policy"><span>&mdash;</span> Privacy Policy</a><script type=text/javascript>(function(e,t){var n=function(){var e=t.createElement("script"),n=t.getElementsByTagName("script")[0];e.src="//cdn.iubenda.com/iubenda.js",n.parentNode.insertBefore(e,n)};e.addEventListener?e.addEventListener("load",n,!1):e.attachEvent?e.attachEvent("onload",n):e.onload=n})(window,document)</script></li></ul></div><div class=footer_column-icon-wrap><a href=https://twitter.com/EngineerBetter class=footer_column-icon><img class=footer_column-icon-img alt=Brand src=/img/icon-twitter.png></a>
<a href=https://github.com/EngineerBetter class=footer_column-icon><img class=footer_column-icon-img alt=Brand src=/img/icon-git-hub.png></a></div><div class=footer_column-text><p>&copy; Copyright EngineerBetter Ltd</p><p>Registered England & Wales 10141478</p></div></div></footer><script src="/js/jquery-1.11.3.min.js?v=4"></script>
<script src=/js/site.js></script></body></html>