<!doctype html><html lang=pl><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>Up and running with BOSH and Concourse - Part 2 | EngineerBetter | More than Cloud Platform specialists</title><link rel=stylesheet href="/css/main.css?v=4"><link rel=stylesheet href=/css/syntax.css><link rel=icon type=image/png href=/img/favicon.png><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-74442484-1","auto"),ga("send","pageview")</script><script src=//load.sumome.com/ data-sumo-site-id=7c63408cd1c29faa63d20123ff629d524df6674695e4305a0e602f2bbf431038 async></script>
<script type=text/javascript>var _iub=_iub||[];_iub.csConfiguration={banner:{textColor:"#dadada",backgroundColor:"#5A5A5A"},lang:"en",siteId:939573,cookiePolicyId:8251825}</script><script type=text/javascript src=//cdn.iubenda.com/cookie_solution/safemode/iubenda_cs.js async></script></head><body><section id=menu-nav-top class="menu fixed-menu clearfix"><div class=menu_contact><p class=menu_contact-number>+44 (0) 20 7846 0140</p><a href=mailto:contact@engineerbetter.com class=menu_contact-us>Contact us</a></div><div class="menu_header clearfix"><button class=menu_header-button>
<span class="icon-bar top-bar"></span>
<span class="icon-bar middle-bar"></span>
<span class="icon-bar bottom-bar"></span></button>
<a href=/ class=menu_header-logo><img class=logo-header-img alt=Brand src=/img/engineer-better-logo.svg></a></div></section><div class=menu_list><button class=menu_list-close><p>&#x2716;</p></button><div class=menu_list-inner-wrap><p class=menu_list-phone>+44 (0) 20 7846 0140</p><a class=menu_list-contact-btn href=mailto:contact@engineerbetter.com>Contact us&nbsp;<span>&#xe900;</span></a><ul class=menu_list-links><li><a href=/how-we-work/>How we work</a></li><li><a href=/our-services/>Our services</a></li><li><a href=/success-stories/>Success stories</a></li><li><a href=/why-cloud-native/>why cloud-native?</a></li><li><a href=/about-us/>About us</a></li><li><a href=/blog/>Blog</a></li></ul><div class=menu_list-icons><a href=https://twitter.com/EngineerBetter><img src=/img/twitter.svg alt="Twitter profile"></a>
<a href=https://github.com/EngineerBetter><img src=/img/github.svg alt="Github profile"></a></div><div class=menu_list-bot-menu><a href=/blog/>Blog</a><span>|</span><a href=/join-our-team/>Careers</a><span>|</span><a href=//www.iubenda.com/privacy-policy/8251825 class="iubenda-nostyle no-brand iubenda-embed" title="Privacy Policy">Privacy</a><script type=text/javascript>(function(e,t){var n=function(){var e=t.createElement("script"),n=t.getElementsByTagName("script")[0];e.src="//cdn.iubenda.com/iubenda.js",n.parentNode.insertBefore(e,n)};e.addEventListener?e.addEventListener("load",n,!1):e.attachEvent?e.attachEvent("onload",n):e.onload=n})(window,document)</script></div></div></div><section class="menu-banner-top_wrap parallax is-page"><div class=menu-banner-top><div class=menu-banner-top_contact><a class=menu-banner-top_number href="tel:+44 (0) 20 7846 0140">+44 (0) 20 7846 0140</a>
<a class=menu-banner-top_contact-us href=mailto:contact@engineerbetter.com>Contact us</a></div><div class=menu-banner-top_btn-wrap><button class=menu_header-button>
<span class="icon-bar top-bar"></span>
<span class="icon-bar middle-bar"></span>
<span class="icon-bar bottom-bar"></span></button></div><div class="menu-banner-top_logo clearfix"><a href=/ class=home-banner_logo-img><img class=logo-img alt=Brand src=/img/engineer-better-logo.svg></a></div></div><div class=home-banner><div class="home-banner_list clearfix"><div class=home-banner_list-category><ul><li><a href=ileri.com/how-we-work/>How we work</a></li><li><a href=ileri.com/our-services/>Our services</a></li><li><a href=ileri.com/success-stories/>Success Stories</a></li><li><a href=ileri.com/why-cloud-native/>Why Cloud-Native?</a></li><li><a href=ileri.com/about-us/>About us</a></li><li><a href=ileri.com/blog/>Blog</a></li></ul></div><div class=home-banner_textarea><h1 class=home-banner_textarea-header>Our <strong>blog&nbsp;<span>&#xe900;</span></strong></h1><div class=home-banner_textarea-wrap><p class=home-banner_textarea-description>Get the very latest updates about recent projects, team updates, thoughts and industry news from our team of EngineerBetter experts.</p></div></div></div></div></section><section class=blog-page><div class=blog-page_container><h1>Up and running with BOSH and Concourse - Part 2</h1><p class=blog-page_details>Jun 1, 2016<span>|</span> Dan Young</p><div class=blog-page_image><img src=/img/blog/phoenix-sky-harbor.jpg></div><p>In <a href=/bosh-concourse.html>Part 1</a> of this tutorial we set up a new BOSH director from scratch on AWS. Now it&rsquo;s time to deploy Concourse!</p><h2 id=what-will-we-do-next>What will we do next?</h2><ul><li>Create a deployment manifest for Concourse</li><li>Upload stemcells and releases, then deploy using BOSH</li><li>Install and get started with the fly cli</li><li>Try a more complex deployment</li></ul><h2 id=setting-up>Setting up</h2><p>The terraform configuration in <a href=/bosh-concourse.html>Part 1</a> will have already created the necessary security groups, subnets and ELB. Set the Concourse URL and a password for postgresql in these environment variables. Your public <code>$CONCOURSE_URL</code> should match the <code>ci_hostname</code> terraform variable that you used earlier, to configure Route53. For example, <a href=https://ci.engineerbetter.com>https://ci.engineerbetter.com</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$DB_PASSWORD</span>
</span></span><span class=line><span class=cl><span class=nv>$CONCOURSE_URL</span>
</span></span></code></pre></div><p>In this example we&rsquo;re going to use GitHub to authenticate our Concourse users, but you could also use basic authentication. First, create a new <a href=https://github.com/settings/applications/new>OAuth application</a> in GitHub and set your authorisation callback URL to <code>https://&lt;your CONCOURSE_URL>/auth/github/callback</code>. Also, create a &lsquo;CI&rsquo; team containing the users who are authorised to access Concourse.</p><p>Then set your GitHub organization, client_id and client_secret:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$GITHUB_ORG</span>
</span></span><span class=line><span class=cl><span class=nv>$GITHUB_CLIENT_ID</span>
</span></span><span class=line><span class=cl><span class=nv>$GITHUB_CLIENT_SECRET</span>
</span></span></code></pre></div><h2 id=create-a-manifest-and-upload-stemcells--releases>Create a manifest and upload stemcells & releases</h2><p>Now you&rsquo;re ready to create a concourse manifest for a simple, single server deployment:</p><p><code>./bin/make_manifest_concourse.sh</code></p><p>You should now have a new <code>concourse.yml</code> manifest in your working directory. Have a look at this and note the stemcells and releases sections. To run your BOSH deployment, you&rsquo;ll need those stemcells and releases on your BOSH Director.</p><p>Go ahead and upload the latest versions of the necessary stemcell & releases:</p><pre tabindex=0><code class=language-shell_session data-lang=shell_session>$ bosh upload stemcell https://bosh.io/d/stemcells/bosh-aws-xen-hvm-ubuntu-trusty-go_agent
$ bosh upload release https://bosh.io/d/github.com/concourse/concourse
$ bosh upload release https://bosh.io/d/github.com/cloudfoundry-incubator/garden-linux-release
</code></pre><p>The commands <code>bosh stemcells</code> and <code>bosh releases</code> will let you know what the BOSH director has in its blobstore.</p><h2 id=deploy>Deploy</h2><p>You&rsquo;re ready to deploy concourse.</p><pre tabindex=0><code class=language-shell_session data-lang=shell_session>$ bosh deployment concourse.yml
$ bosh deploy
</code></pre><p>Watch while BOSH compiles packages, creates the VMs and runs the jobs defined in the manifest. Keep an eye on EC2 to see instances being used for the deployment. My BOSH Director already has the packages in its blobstore, so I see the following output.</p><p>Congratulations, you should now be able to see your new CI server at https://your-concourse-url.</p><p>If you can&rsquo;t see anything yet check your AWS ELB - it&rsquo;s probably that your new instance is not yet <code>InService</code>, due to the polling interval.</p><h2 id=install-fly-cli-and-log-in>Install <code>fly</code> cli and log in</h2><p>Now, it&rsquo;s time to get familiar with the <code>fly</code> cli tool if you&rsquo;re not already. You&rsquo;ll find the download link on landing page of your new Concourse GUI (known as the ATC/Air Traffic Control). Put it somewhere suitable in your path like <code>~/bin</code>.</p><p>The <code>fly</code> tool uses the concept of targets to ensure that you&rsquo;re always being explicit about <em>where</em> commands should be executed. Choose a name for your new CI server target and then run the following:</p><pre tabindex=0><code class=language-shell_session data-lang=shell_session>$ fly -t target_name login -c https://&lt;your-concourse-url&gt;
</code></pre><p>If you haven&rsquo;t already looked at the excellent Concourse documentation, you&rsquo;ll find they have a great <a href=http://concourse.ci/hello-world.html>hello world tutorial</a></p><h2 id=what-next>What next?</h2><p>Try replacing your single instance with a cluster, allowing you to run a scalable deployment. An example manifest can be generated with the script <code>bin/make_manifest_concourse-cluster.sh</code>. Notice how this manifest uses multiple instance groups to distribute the BOSH jobs across a cluster of instances.</p><p>Running a clustered concourse deployment with multiple ATCs will allow you to upgrade your CI environment without users experiencing an outage. You may find this particularly useful, given the pace at which Concourse is evolving.</p></div><div class="blog-page_banner clearfix"><div class=blog_banner-text><h2>Get in touch</h2><p>See how much we can help you.<br>Call <span>+44 (0) 20 7846 0140</span> or</br></p><a href=mailto:contact@engineerbetter.com class=cloud-btn2><p>Contact us <span>&#xe900;</span></p></a></div></div></section><footer><div class=footer-background></div><div class="footer_wrap clearfix"><div class=footer_column-list-desktop><ul class=list><li><a href=/how-we-work/><span>&mdash;</span> How we work</a></li><li><a href=/our-services/><span>&mdash;</span> Our services</a></li><li><a href=/success-stories/><span>&mdash;</span> Success stories</a></li><li><a href=/why-cloud-native/><span>&mdash;</span> Why Cloud-Native?</a></li><li><a href=/about-us/><span>&mdash;</span> About us</a></li></ul></div><div class=footer_column-list><ul class=list><li><a href=mailto:contact@engineerbetter.com><span>&mdash;</span> Contact us</a></li><li><a href=/blog/><span>&mdash;</span> Blog</a></li><li><a href=/join-our-team/><span>&mdash;</span> Join our team</a></li><li><a href=//www.iubenda.com/privacy-policy/8251825 class="iubenda-nostyle no-brand iubenda-embed" title="Privacy Policy"><span>&mdash;</span> Privacy Policy</a><script type=text/javascript>(function(e,t){var n=function(){var e=t.createElement("script"),n=t.getElementsByTagName("script")[0];e.src="//cdn.iubenda.com/iubenda.js",n.parentNode.insertBefore(e,n)};e.addEventListener?e.addEventListener("load",n,!1):e.attachEvent?e.attachEvent("onload",n):e.onload=n})(window,document)</script></li></ul></div><div class=footer_column-icon-wrap><a href=https://twitter.com/EngineerBetter class=footer_column-icon><img class=footer_column-icon-img alt=Brand src=/img/icon-twitter.png></a>
<a href=https://github.com/EngineerBetter class=footer_column-icon><img class=footer_column-icon-img alt=Brand src=/img/icon-git-hub.png></a></div><div class=footer_column-text><p>&copy; Copyright EngineerBetter Ltd</p><p>Registered England & Wales 10141478</p></div></div></footer><script src="/js/jquery-1.11.3.min.js?v=4"></script>
<script src=/js/site.js></script></body></html>