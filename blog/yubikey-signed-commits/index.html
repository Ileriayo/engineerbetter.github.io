<!doctype html><html lang=pl><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>Yubikeys for Signed Git Commits | EngineerBetter | More than Cloud Platform specialists</title><link rel=stylesheet href="/css/main.css?v=4"><link rel=stylesheet href=/css/syntax.css><link rel=icon type=image/png href=/img/favicon.png><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-74442484-1","auto"),ga("send","pageview")</script><script src=//load.sumome.com/ data-sumo-site-id=7c63408cd1c29faa63d20123ff629d524df6674695e4305a0e602f2bbf431038 async></script>
<script type=text/javascript>var _iub=_iub||[];_iub.csConfiguration={banner:{textColor:"#dadada",backgroundColor:"#5A5A5A"},lang:"en",siteId:939573,cookiePolicyId:8251825}</script><script type=text/javascript src=//cdn.iubenda.com/cookie_solution/safemode/iubenda_cs.js async></script></head><body><section id=menu-nav-top class="menu fixed-menu clearfix"><div class=menu_contact><p class=menu_contact-number>+44 (0) 20 7846 0140</p><a href=mailto:contact@engineerbetter.com class=menu_contact-us>Contact us</a></div><div class="menu_header clearfix"><button class=menu_header-button>
<span class="icon-bar top-bar"></span>
<span class="icon-bar middle-bar"></span>
<span class="icon-bar bottom-bar"></span></button>
<a href=/ class=menu_header-logo><img class=logo-header-img alt=Brand src=/img/engineer-better-logo.svg></a></div></section><div class=menu_list><button class=menu_list-close><p>&#x2716;</p></button><div class=menu_list-inner-wrap><p class=menu_list-phone>+44 (0) 20 7846 0140</p><a class=menu_list-contact-btn href=mailto:contact@engineerbetter.com>Contact us&nbsp;<span>&#xe900;</span></a><ul class=menu_list-links><li><a href=/how-we-work/>How we work</a></li><li><a href=/our-services/>Our services</a></li><li><a href=/success-stories/>Success stories</a></li><li><a href=/why-cloud-native/>why cloud-native?</a></li><li><a href=/about-us/>About us</a></li><li><a href=/blog/>Blog</a></li></ul><div class=menu_list-icons><a href=https://twitter.com/EngineerBetter><img src=/img/twitter.svg alt="Twitter profile"></a>
<a href=https://github.com/EngineerBetter><img src=/img/github.svg alt="Github profile"></a></div><div class=menu_list-bot-menu><a href=/blog/>Blog</a><span>|</span><a href=/join-our-team/>Careers</a><span>|</span><a href=//www.iubenda.com/privacy-policy/8251825 class="iubenda-nostyle no-brand iubenda-embed" title="Privacy Policy">Privacy</a><script type=text/javascript>(function(e,t){var n=function(){var e=t.createElement("script"),n=t.getElementsByTagName("script")[0];e.src="//cdn.iubenda.com/iubenda.js",n.parentNode.insertBefore(e,n)};e.addEventListener?e.addEventListener("load",n,!1):e.attachEvent?e.attachEvent("onload",n):e.onload=n})(window,document)</script></div></div></div><section class="menu-banner-top_wrap parallax is-page"><div class=menu-banner-top><div class=menu-banner-top_contact><a class=menu-banner-top_number href="tel:+44 (0) 20 7846 0140">+44 (0) 20 7846 0140</a>
<a class=menu-banner-top_contact-us href=mailto:contact@engineerbetter.com>Contact us</a></div><div class=menu-banner-top_btn-wrap><button class=menu_header-button>
<span class="icon-bar top-bar"></span>
<span class="icon-bar middle-bar"></span>
<span class="icon-bar bottom-bar"></span></button></div><div class="menu-banner-top_logo clearfix"><a href=/ class=home-banner_logo-img><img class=logo-img alt=Brand src=/img/engineer-better-logo.svg></a></div></div><div class=home-banner><div class="home-banner_list clearfix"><div class=home-banner_list-category><ul><li><a href=ileri.com/how-we-work/>How we work</a></li><li><a href=ileri.com/our-services/>Our services</a></li><li><a href=ileri.com/success-stories/>Success Stories</a></li><li><a href=ileri.com/why-cloud-native/>Why Cloud-Native?</a></li><li><a href=ileri.com/about-us/>About us</a></li><li><a href=ileri.com/blog/>Blog</a></li></ul></div><div class=home-banner_textarea><h1 class=home-banner_textarea-header>Our <strong>blog&nbsp;<span>&#xe900;</span></strong></h1><div class=home-banner_textarea-wrap><p class=home-banner_textarea-description>Get the very latest updates about recent projects, team updates, thoughts and industry news from our team of EngineerBetter experts.</p></div></div></div></div></section><section class=blog-page><div class=blog-page_container><h1>Yubikeys for Signed Git Commits</h1><p class=blog-page_details>Apr 30, 2019<span>|</span> Daniel Jones</p><div class=blog-page_image><img src=/img/blog/yubikey-signing-emancipation-proclamation.jpg></div><p>By signing our Git commits, we can allow folks to verify that they were really written by the author tagged on the commit. If you&rsquo;ve got a <a href=/blog/yubikey-all-the-things/>Yubikey set up as per our other blog posts</a>, it&rsquo;s a doddle to configure.</p><h2 id=ensure-public-key-is-on-keychain>Ensure Public Key is on Keychain</h2><p>Your public key needs to be on your GPG installation&rsquo;s keychain.</p><p>First, see if it is already on your chain (using your own address!):</p><pre tabindex=0><code class=language-terminal data-lang=terminal>$ gpg --list-secret daniel.jones@engineerbetter.com
</code></pre><p>If you see something like this, then you already have your public key available and can proceed to <a href=#share-with-github>Share With GitHub</a>:</p><pre tabindex=0><code class=language-terminal data-lang=terminal>sec&gt;  rsa2048/ADD0D0CAFEDECADE 2017-11-22 [SC] [expires: 2021-04-29]
      FEEDBEEFC0C0A7D867D34ADEADD0D0CAFEDECADE
      Card serial no. = 0006 06917459
uid                 [ultimate] Daniel Jones &lt;daniel.jones@engineerbetter.com&gt;
ssb&gt;  rsa2048/AF5A4B5AA8A8C5BF 2017-11-22 [A] [expires: 2021-04-29]
ssb&gt;  rsa2048/BA53B2D6734C8A8E 2017-11-22 [E] [expires: 2021-04-29]
</code></pre><p>If you don&rsquo;t see the above, we&rsquo;ll need to get hold of it.</p><p>Recent versions of the prior blog post suggested uploading your public key to a keyserver. You can find out if your key is on a given server with:</p><pre tabindex=0><code class=language-terminal data-lang=terminal>$ gpg --keyserver keys.gnupg.net --search daniel.jones@engineerbetter.com
</code></pre><p><strong>If</strong> you experience the following&mldr;</p><pre tabindex=0><code class=language-terminal data-lang=terminal>$ gpg --keyserver keys.gnupg.net --search daniel.jones@engineerbetter.com
$ gpg: error searching keyserver: Server indicated a failure
$ gpg: keyserver search failed: Server indicated a failure
</code></pre><p>Try adding the <code>hkp</code> protocol along with a port override:</p><pre tabindex=0><code class=language-terminal data-lang=terminal>$ gpg --keyserver hkp://keys.gnupg.net:80 --search daniel.jones@engineerbetter.com
</code></pre><p>Results (if any) are numbered, and simply selecting the right number from the list will import your key.</p><p>If you didn&rsquo;t upload your public key to any keyservers but still have access to the machine upon which you generated the key (or any other where it is in the keychain) then you can export it, ready for import:</p><pre tabindex=0><code class=language-terminal data-lang=terminal>$ gpg --armor --export daniel.jones@engineerbetter.com &gt; public.asc
</code></pre><p>Copy the file to the other machine, and then import it:</p><pre tabindex=0><code>$ gpg --import /path/to/public.asc
</code></pre><p>Obviously this is a fragile solution, so <a href=/blog/yubikey-ssh#sharing-your-public-key>uploading it to a keyserver</a> once you&rsquo;re done is a good idea.</p><h2 id=share-with-github>Share With GitHub</h2><p>You need to tell GitHub about your public key. The argument here is the long ID from above (<code>gpg --list-secret &lt;email-address></code>):</p><pre tabindex=0><code class=language-terminal data-lang=terminal>$ gpg --armor --export FEEDBEEFC0C0A7D867D34ADEADD0D0CAFEDECADE
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQENBFoVTx8BCAD29H458Y3YwqGoG1HDEDiiAGaZoMONCh0Ql27CI7eSxhB08lI2
[...SNIP!]
DVeNShSNf4K9uOS62gEQROZQClA/
=xOmv
-----END PGP PUBLIC KEY BLOCK-----
</code></pre><p>Copy the above public key, including the begin and end blocks, and then <a href=https://github.com/settings/gpg/new><strong>add it as a new key on GitHub</strong></a>.</p><p>We then need to <strong>tell Git to use GPG to sign commits</strong>, and specifically this key. Use the <em>short</em> ID from the output of the <code>--list-secret</code> command we ran earlier. In my example, it follows after <code>rsa2048</code>:</p><p>If the <em>short</em> ID is not present in the output, try running the command with <code>--keyid-format LONG</code>.</p><pre tabindex=0><code class=language-terminal data-lang=terminal>git config --global commit.gpgsign true
git config --global user.signingkey ADD0D0CAFEDECADE
</code></pre><p>Nearly there! Let&rsquo;s now <strong>restart the GPG agent</strong>:</p><pre tabindex=0><code class=language-terminal data-lang=terminal>gpg-connect-agent reloadagent /bye
</code></pre><h2 id=testing>Testing</h2><p>Make a commit in any repository, and hopefully you shouldn&rsquo;t see an error message.</p><p>Run <code>git log --show-signature</code> to check that the commit was signed:</p><pre tabindex=0><code class=language-terminal data-lang=terminal>$ git log --show-signature
commit d1972b6a7a3534413aec91f06d7bd0fdf9bcdc0e (HEAD -&gt; master)
gpg: Signature made Tue 30 Apr 11:50:07 2019 BST
gpg:                using RSA key FEEDBEEFC0C0A7D867D34ADEADD0D0CAFEDECADE
gpg: Good signature from &#34;Daniel Jones &lt;daniel.jones@engineerbetter.com&gt;&#34; [ultimate]
Author: Daniel Jones &lt;daniel.jones@engineerbetter.com&gt;
Date:   Tue Apr 30 11:50:07 2019 +0100

    informative message
</code></pre><h3 id=errors>Errors?</h3><p>If when you made the commit you were greeted with the error <code>git error: gpg failed to sign the data</code>, there could be a number of causes:</p><ul><li>Git is configured to use the <a href=https://stackoverflow.com/a/40066889/774395>wrong <code>gpg</code> executable</a></li><li>Your <a href=/blog/yubikey-ssh/#extending-the-life-of-the-key>GPG key is expired and needs extending</a></li></ul><h2 id=push>Push</h2><p>Assuming that everything has worked thus far, you can now <code>git push</code> and bask in the resplendent glory of a lovely &ldquo;Verified&rdquo; badge on GitHub:</p><h2 id=why-bother>Why Bother?</h2><p>You might ask what the benefit of all this is. After all, you&rsquo;re already authing to GitHub with your SSH key, right?</p><p>Your SSH key proves that you can talk to GitHub, and that you&rsquo;re allowed access to the repository in question. It <em>doesn&rsquo;t</em> prove that the commits you are pushing were really written by the flagged authors though.</p><p>It&rsquo;s trivial to make a commit with a false identity:</p><pre tabindex=0><code class=language-terminal data-lang=terminal>git commit -m &#34;implement sensible error handling&#34; --author=&#34;Rob Pike &lt;rob@google.com&gt;&#34;
</code></pre><p>You can then push this, authenticating with <em>your</em> SSH key (or HTTP basic credentials), which is of course totally valid.</p><p>You&rsquo;ve then managed to masquerade as a colleague, presumably pushing awesome code to help them get a raise. Or, perhaps, you&rsquo;ve done something nefarious. But you&rsquo;d never do a thing like that, would you?</p></div><div class="blog-page_banner clearfix"><div class=blog_banner-text><h2>Get in touch</h2><p>See how much we can help you.<br>Call <span>+44 (0) 20 7846 0140</span> or</br></p><a href=mailto:contact@engineerbetter.com class=cloud-btn2><p>Contact us <span>&#xe900;</span></p></a></div></div></section><footer><div class=footer-background></div><div class="footer_wrap clearfix"><div class=footer_column-list-desktop><ul class=list><li><a href=/how-we-work/><span>&mdash;</span> How we work</a></li><li><a href=/our-services/><span>&mdash;</span> Our services</a></li><li><a href=/success-stories/><span>&mdash;</span> Success stories</a></li><li><a href=/why-cloud-native/><span>&mdash;</span> Why Cloud-Native?</a></li><li><a href=/about-us/><span>&mdash;</span> About us</a></li></ul></div><div class=footer_column-list><ul class=list><li><a href=mailto:contact@engineerbetter.com><span>&mdash;</span> Contact us</a></li><li><a href=/blog/><span>&mdash;</span> Blog</a></li><li><a href=/join-our-team/><span>&mdash;</span> Join our team</a></li><li><a href=//www.iubenda.com/privacy-policy/8251825 class="iubenda-nostyle no-brand iubenda-embed" title="Privacy Policy"><span>&mdash;</span> Privacy Policy</a><script type=text/javascript>(function(e,t){var n=function(){var e=t.createElement("script"),n=t.getElementsByTagName("script")[0];e.src="//cdn.iubenda.com/iubenda.js",n.parentNode.insertBefore(e,n)};e.addEventListener?e.addEventListener("load",n,!1):e.attachEvent?e.attachEvent("onload",n):e.onload=n})(window,document)</script></li></ul></div><div class=footer_column-icon-wrap><a href=https://twitter.com/EngineerBetter class=footer_column-icon><img class=footer_column-icon-img alt=Brand src=/img/icon-twitter.png></a>
<a href=https://github.com/EngineerBetter class=footer_column-icon><img class=footer_column-icon-img alt=Brand src=/img/icon-git-hub.png></a></div><div class=footer_column-text><p>&copy; Copyright EngineerBetter Ltd</p><p>Registered England & Wales 10141478</p></div></div></footer><script src="/js/jquery-1.11.3.min.js?v=4"></script>
<script src=/js/site.js></script></body></html>