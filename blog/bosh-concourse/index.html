<!doctype html><html lang=pl><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>Up and running with BOSH and Concourse - Part 1 | EngineerBetter | More than Cloud Platform specialists</title><link rel=stylesheet href="/css/main.css?v=4"><link rel=stylesheet href=/css/syntax.css><link rel=icon type=image/png href=/img/favicon.png><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-74442484-1","auto"),ga("send","pageview")</script><script src=//load.sumome.com/ data-sumo-site-id=7c63408cd1c29faa63d20123ff629d524df6674695e4305a0e602f2bbf431038 async></script>
<script type=text/javascript>var _iub=_iub||[];_iub.csConfiguration={banner:{textColor:"#dadada",backgroundColor:"#5A5A5A"},lang:"en",siteId:939573,cookiePolicyId:8251825}</script><script type=text/javascript src=//cdn.iubenda.com/cookie_solution/safemode/iubenda_cs.js async></script></head><body><section id=menu-nav-top class="menu fixed-menu clearfix"><div class=menu_contact><p class=menu_contact-number>+44 (0) 20 7846 0140</p><a href=mailto:contact@engineerbetter.com class=menu_contact-us>Contact us</a></div><div class="menu_header clearfix"><button class=menu_header-button>
<span class="icon-bar top-bar"></span>
<span class="icon-bar middle-bar"></span>
<span class="icon-bar bottom-bar"></span></button>
<a href=/ class=menu_header-logo><img class=logo-header-img alt=Brand src=/img/engineer-better-logo.svg></a></div></section><div class=menu_list><button class=menu_list-close><p>&#x2716;</p></button><div class=menu_list-inner-wrap><p class=menu_list-phone>+44 (0) 20 7846 0140</p><a class=menu_list-contact-btn href=mailto:contact@engineerbetter.com>Contact us&nbsp;<span>&#xe900;</span></a><ul class=menu_list-links><li><a href=/how-we-work/>How we work</a></li><li><a href=/our-services/>Our services</a></li><li><a href=/success-stories/>Success stories</a></li><li><a href=/why-cloud-native/>why cloud-native?</a></li><li><a href=/about-us/>About us</a></li><li><a href=/blog/>Blog</a></li></ul><div class=menu_list-icons><a href=https://twitter.com/EngineerBetter><img src=/img/twitter.svg alt="Twitter profile"></a>
<a href=https://github.com/EngineerBetter><img src=/img/github.svg alt="Github profile"></a></div><div class=menu_list-bot-menu><a href=/blog/>Blog</a><span>|</span><a href=/join-our-team/>Careers</a><span>|</span><a href=//www.iubenda.com/privacy-policy/8251825 class="iubenda-nostyle no-brand iubenda-embed" title="Privacy Policy">Privacy</a><script type=text/javascript>(function(e,t){var n=function(){var e=t.createElement("script"),n=t.getElementsByTagName("script")[0];e.src="//cdn.iubenda.com/iubenda.js",n.parentNode.insertBefore(e,n)};e.addEventListener?e.addEventListener("load",n,!1):e.attachEvent?e.attachEvent("onload",n):e.onload=n})(window,document)</script></div></div></div><section class="menu-banner-top_wrap parallax is-page"><div class=menu-banner-top><div class=menu-banner-top_contact><a class=menu-banner-top_number href="tel:+44 (0) 20 7846 0140">+44 (0) 20 7846 0140</a>
<a class=menu-banner-top_contact-us href=mailto:contact@engineerbetter.com>Contact us</a></div><div class=menu-banner-top_btn-wrap><button class=menu_header-button>
<span class="icon-bar top-bar"></span>
<span class="icon-bar middle-bar"></span>
<span class="icon-bar bottom-bar"></span></button></div><div class="menu-banner-top_logo clearfix"><a href=/ class=home-banner_logo-img><img class=logo-img alt=Brand src=/img/engineer-better-logo.svg></a></div></div><div class=home-banner><div class="home-banner_list clearfix"><div class=home-banner_list-category><ul><li><a href=ileri.com/how-we-work/>How we work</a></li><li><a href=ileri.com/our-services/>Our services</a></li><li><a href=ileri.com/success-stories/>Success Stories</a></li><li><a href=ileri.com/why-cloud-native/>Why Cloud-Native?</a></li><li><a href=ileri.com/about-us/>About us</a></li><li><a href=ileri.com/blog/>Blog</a></li></ul></div><div class=home-banner_textarea><h1 class=home-banner_textarea-header>Our <strong>blog&nbsp;<span>&#xe900;</span></strong></h1><div class=home-banner_textarea-wrap><p class=home-banner_textarea-description>Get the very latest updates about recent projects, team updates, thoughts and industry news from our team of EngineerBetter experts.</p></div></div></div></div></section><section class=blog-page><div class=blog-page_container><h1>Up and running with BOSH and Concourse - Part 1</h1><p class=blog-page_details>May 5, 2016<span>|</span> Dan Young</p><div class=blog-page_image><img src=/img/blog/concourse-example.png></div><p>The Cloud Foundry ecosystem has given rise to some amazing things. This series of posts is about two of them - BOSH and Concourse. Together with CF, they form an awesome triangle of tools that will change the way you think about how to get things done when delivering software.</p><p>BOSH is the distributed systems powerhouse that makes Cloud Foundry possible. It answers the impossible question: How do you continuously deliver not just an app, but <em>an entire platform</em> of distributed virtual infrastructure?</p><p>Concourse is a intuitive, cloud-native CI tool that has a powerful simplicity to it. Actually, I&rsquo;d go so far as to say it&rsquo;s more than just an automation tool, it&rsquo;s a medium for artistic expression! Just have a look at some of the vast Pivotal pipelines (e.g. <a href=https://buildpacks.ci.cf-app.com/>the Buildpacks team</a>) and marvel at their aesthetic value.</p><p>If you haven’t used Concourse yet you should <a href=http://concourse.ci/>visit their site</a> and try the Vagrant box locally - you’ll be up and running in just a few minutes. If you&rsquo;re not familiar with BOSH, stop right now and read about <a href=https://bosh.io/docs/about.html>why you need it</a>. If you want to try out BOSH locally and have a fast laptop with 8-16GB RAM, you should play with <a href=https://github.com/cloudfoundry/bosh-lite>bosh-lite</a>. I can also highly recommend this brilliant <a href=http://mariash.github.io/learn-bosh/>intro tutorial</a> by <a href=https://twitter.com/marynixie>Maria Shaldibina</a> at Pivotal.</p><p>If you follow this tutorial and deploy a BOSH Director on IaaS, you can then use it to deploy any other <a href=https://bosh.io/releases>available release</a>. Be careful though - once you’re wielding your new weapon you may want to just go crazy and deploy your whole life using BOSH. You should be aware that there are &lsquo;7 stages of BOSH’ you must endure to achieve mastery, as <a href=/update/2015/10/31/cf-summit-berlin.html>humorously explained</a> by <a href=http://www.twitter.com/DanielJonesEB>Daniel Jones</a> (EngineerBetter) and <a href=http://www.twitter.com/CGHSystems>Chris Hedley</a> (Pivotal) at CFSummit Berlin 2015.</p><p>The Concourse Vagrant box works like a dream for testing - being able to test your whole pipeline or just individual jobs locally is a killer feature - but eventually you’ll need to take things to the cloud. The aim of this tutorial is to get you up and running with a BOSH director and a fresh deployment of Concourse on AWS. Please remember, the examples provided here are for demo purposes and should not be considered production-ready.</p><h2 id=what-does-this-tutorial-cover>What does this tutorial cover?</h2><p>In Part 1 we will do the following:</p><ul><li>Prepare the AWS environment</li><li>Deploy a new BOSH Director using bosh-init</li><li>Log in to the Director and set up cloud-config.</li></ul><p>In Part 2 we will:</p><ul><li>Create a deployment manifest for Concourse and deploy using BOSH</li><li>Install and get started with the fly cli</li><li>Create a pipeline in Concourse</li></ul><h2 id=setting-up>Setting up</h2><p>First, clone the GitHub repo accompanying this tutorial:</p><pre tabindex=0><code class=language-shell_session data-lang=shell_session>$ git clone https://github.com/EngineerBetter/bosh-concourse-setup
</code></pre><p>We&rsquo;re going to use Terraform to express our desired AWS environment as code, so we can put this in source control along with everything else. The terraform configuration we’re using will create the network and security resources for BOSH, but also an elastic load balancer for Concourse with an SSL listener. However, this does assume that you already have the following:</p><ul><li>A <a href=http://docs.aws.amazon.com/Route53/latest/DeveloperGuide/CreatingHostedZone.html>Route53 Zone</a> you can add records to.</li><li>Created an <a href=http://docs.aws.amazon.com/ElasticLoadBalancing/latest/DeveloperGuide/ssl-server-cert.html>SSL certificate</a> in AWS for your Concourse ELB</li></ul><p>You will also need an EC2 SSH <a href=http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html>key pair</a> before you start.</p><p>Once you have these, it&rsquo;s time to install some tools! You’ll need to use either Linux or OSX with Ruby installed for the bosh tools. Terraform will work on Windows.</p><ul><li>Install the <a href=https://www.terraform.io/intro/getting-started/install.html>terraform</a> binaries from Hashicorp</li><li>Install <a href=https://bosh.io/docs/install-bosh-init.html>bosh-init</a></li><li>Install the <a href=https://bosh.io/docs/bosh-cli.html>bosh_cli</a> Ruby gem</li></ul><h2 id=using-terraform-to-configure-aws>Using Terraform to configure AWS</h2><p>The Terraform config needs to know about some parameters that are specific to you and your AWS environment. These are defined in <code>variables.tf</code> and we set the corresponding values either in environment variables, or a file. You can use the example tfvars file:</p><pre tabindex=0><code class=language-shell_session data-lang=shell_session>$ cd terraform
$ cp terraform.tfvars.example terraform.tfvars
</code></pre><p>Then edit <code>variables.tfvars</code> to provide your own values. Set your desired AWS region in <code>variables.tf</code>. Ensure terraform is in your path, then apply the configuration:</p><pre tabindex=0><code class=language-shell_session data-lang=shell_session>$ terraform apply
</code></pre><p>Terraform will execute the plan and save the state of your environment locally. If you need to make any changes, just reapply and it will converge towards your new desired state. A nice feature of terraform is being able to output a dependency graph of your resources. If you have Graphviz installed, you can do this:</p><pre tabindex=0><code class=language-shell_session data-lang=shell_session>$ terraform graph | dot -Tpng &gt; graph.png
</code></pre><p>Which produces this:</p><p>You should check the terraform output values and make a note of the elastic IP we&rsquo;ll use for the BOSH director using <code>terraform output</code></p><h2 id=deploying-a-bosh-director>Deploying a BOSH Director</h2><p>Now we should have an EIP, VPC, Subnet and Security Groups ready for BOSH.
We&rsquo;re going to create a manifest for <code>bosh-init</code>. First you should set the following environment variables:</p><pre tabindex=0><code class=language-shell_session data-lang=shell_session>$AWS_ACCESS_KEY_ID
$AWS_SECRET_ACCESS_KEY
$AWS_REGION
$AWS_AZ
$BOSH_PASSWORD
$AWS_KEYPAIR_KEY_NAME
$PRIVATE_KEY_PATH
</code></pre><p>Then you can go ahead and create the <code>bosh-director.yml</code> manifest:</p><pre tabindex=0><code class=language-shell_session data-lang=shell_session>$ ./bin/make_manifest_bosh-init.sh
</code></pre><p>Once this is done, you are ready to deploy the BOSH Director. Are you ready?</p><pre tabindex=0><code class=language-shell_session data-lang=shell_session>$ bosh-init deploy bosh-director.yml
</code></pre><p>Now go and make yourself a cup of tea - this deployment will take a while.
While you&rsquo;re drinking your tea, why not read <a href=https://bosh.io/docs>more about BOSH</a>?</p><p>Back in your terminal, you should eventually see something like this:</p><h3 id=logging-in-and-setting-up-cloud-config>Logging in and setting up cloud-config</h3><p>Once the director is deployed, you can target it using the bosh cli and log in using the admin account and your chosen password.</p><pre tabindex=0><code class=language-shell_session data-lang=shell_session>$ bosh target &lt;your elastic ip address&gt;
</code></pre><p>&lsquo;BOSH 2.0&rsquo; now uses a concept called cloud-config which separates IaaS-specific config like IP addressing from the deployment manifests and makes it an operator rather than user concern. Set your chosen AWS AZ and your subnet_id in <code>aws-cloud.yml</code>. Use <code>terraform output subnet_id</code> to get your subnet_id, or just run the script provided in <code>bin/make_cloud_config.sh</code> to output <code>aws-cloud.yml</code></p><p>Then you can tell BOSH to update the config:</p><pre tabindex=0><code class=language-shell_session data-lang=shell_session>$ bosh update cloud-config aws-cloud.yml
</code></pre><p>You can use <code>bosh cloud-config</code> to output your current configuration at any time.</p><p>Congratulations, you have a working BOSH Director!</p><p>Once you&rsquo;ve finished playing and want to tear down your whole environment, first tell bosh-init and to delete the deployment:</p><pre tabindex=0><code class=language-shell_session data-lang=shell_session>$ bosh-init delete bosh-director.yml
</code></pre><p>Then use terraform to destroy your configuration in AWS:</p><pre tabindex=0><code class=language-shell_session data-lang=shell_session>$ terraform destroy
</code></pre><p>In the <a href=/bosh-concourse2.html>2nd part</a> of this post, we will look at using BOSH to deploy Concourse.</p></div><div class="blog-page_banner clearfix"><div class=blog_banner-text><h2>Get in touch</h2><p>See how much we can help you.<br>Call <span>+44 (0) 20 7846 0140</span> or</br></p><a href=mailto:contact@engineerbetter.com class=cloud-btn2><p>Contact us <span>&#xe900;</span></p></a></div></div></section><footer><div class=footer-background></div><div class="footer_wrap clearfix"><div class=footer_column-list-desktop><ul class=list><li><a href=/how-we-work/><span>&mdash;</span> How we work</a></li><li><a href=/our-services/><span>&mdash;</span> Our services</a></li><li><a href=/success-stories/><span>&mdash;</span> Success stories</a></li><li><a href=/why-cloud-native/><span>&mdash;</span> Why Cloud-Native?</a></li><li><a href=/about-us/><span>&mdash;</span> About us</a></li></ul></div><div class=footer_column-list><ul class=list><li><a href=mailto:contact@engineerbetter.com><span>&mdash;</span> Contact us</a></li><li><a href=/blog/><span>&mdash;</span> Blog</a></li><li><a href=/join-our-team/><span>&mdash;</span> Join our team</a></li><li><a href=//www.iubenda.com/privacy-policy/8251825 class="iubenda-nostyle no-brand iubenda-embed" title="Privacy Policy"><span>&mdash;</span> Privacy Policy</a><script type=text/javascript>(function(e,t){var n=function(){var e=t.createElement("script"),n=t.getElementsByTagName("script")[0];e.src="//cdn.iubenda.com/iubenda.js",n.parentNode.insertBefore(e,n)};e.addEventListener?e.addEventListener("load",n,!1):e.attachEvent?e.attachEvent("onload",n):e.onload=n})(window,document)</script></li></ul></div><div class=footer_column-icon-wrap><a href=https://twitter.com/EngineerBetter class=footer_column-icon><img class=footer_column-icon-img alt=Brand src=/img/icon-twitter.png></a>
<a href=https://github.com/EngineerBetter class=footer_column-icon><img class=footer_column-icon-img alt=Brand src=/img/icon-git-hub.png></a></div><div class=footer_column-text><p>&copy; Copyright EngineerBetter Ltd</p><p>Registered England & Wales 10141478</p></div></div></footer><script src="/js/jquery-1.11.3.min.js?v=4"></script>
<script src=/js/site.js></script></body></html>